(function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd&&define("GMaps",[],t);e.GMaps=t()})(this,function(){if(typeof window.google!="object"||!window.google.maps)throw"Google Maps API is required. Please register the following JavaScript library http://maps.google.com/maps/api/js?sensor=true.";var t=function(e,t){var n;if(e===t)return e;for(n in t)e[n]=t[n];return e},n=function(e,t){var n;if(e===t)return e;for(n in t)e[n]!=undefined&&(e[n]=t[n]);return e},r=function(e,t){var n=Array.prototype.slice.call(arguments,2),r=[],i=e.length,s;if(Array.prototype.map&&e.map===Array.prototype.map)r=Array.prototype.map.call(e,function(e){callback_params=n;callback_params.splice(0,0,e);return t.apply(this,callback_params)});else for(s=0;s<i;s++){callback_params=n;callback_params.splice(0,0,e[s]);r.push(t.apply(this,callback_params))}return r},i=function(e){var t=[],n;for(n=0;n<e.length;n++)t=t.concat(e[n]);return t},s=function(e,t){var n=e[0],r=e[1];if(t){n=e[1];r=e[0]}return new google.maps.LatLng(n,r)},o=function(e,t){var n;for(n=0;n<e.length;n++)e[n]instanceof google.maps.LatLng||(e[n].length>0&&typeof e[n][0]=="object"?e[n]=o(e[n],t):e[n]=s(e[n],t));return e},u=function(e,t){var n,e=e.replace("#","");"jQuery"in this&&t?n=$("#"+e,t)[0]:n=document.getElementById(e);return n},a=function(e){var t=0,n=0;if(e.offsetParent)do{t+=e.offsetLeft;n+=e.offsetTop}while(e=e.offsetParent);return[t,n]},f=function(e){"use strict";var n=document,r=function(e){if(!this)return new r(e);e.zoom=e.zoom||15;e.mapType=e.mapType||"roadmap";var i=this,s,o=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","idle","maptypeid_changed","projection_changed","resize","tilesloaded","zoom_changed"],f=["mousemove","mouseout","mouseover"],l=["el","lat","lng","mapType","width","height","markerClusterer","enableNewStyle"],c=e.el||e.div,h=e.markerClusterer,p=google.maps.MapTypeId[e.mapType.toUpperCase()],d=new google.maps.LatLng(e.lat,e.lng),v=e.zoomControl||!0,m=e.zoomControlOpt||{style:"DEFAULT",position:"TOP_LEFT"},g=m.style||"DEFAULT",y=m.position||"TOP_LEFT",b=e.panControl||!0,w=e.mapTypeControl||!0,E=e.scaleControl||!0,S=e.streetViewControl||!0,x=x||!0,T={},N={zoom:this.zoom,center:d,mapTypeId:p},C={panControl:b,zoomControl:v,zoomControlOptions:{style:google.maps.ZoomControlStyle[g],position:google.maps.ControlPosition[y]},mapTypeControl:w,scaleControl:E,streetViewControl:S,overviewMapControl:x};typeof e.el=="string"||typeof e.div=="string"?this.el=u(c,e.context):this.el=c;if(typeof this.el=="undefined"||this.el===null)throw"No element defined.";window.context_menu=window.context_menu||{};window.context_menu[i.el.id]={};this.controls=[];this.overlays=[];this.layers=[];this.singleLayers={};this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.infoWindow=null;this.overlay_el=null;this.zoom=e.zoom;this.registered_events={};this.el.style.width=e.width||this.el.scrollWidth||this.el.offsetWidth;this.el.style.height=e.height||this.el.scrollHeight||this.el.offsetHeight;google.maps.visualRefresh=e.enableNewStyle;for(s=0;s<l.length;s++)delete e[l[s]];e.disableDefaultUI!=1&&(N=t(N,C));T=t(N,e);for(s=0;s<o.length;s++)delete T[o[s]];for(s=0;s<f.length;s++)delete T[f[s]];this.map=new google.maps.Map(this.el,T);h&&(this.markerClusterer=h.apply(this,[this.map]));var k=function(e,t){var n="",r=window.context_menu[i.el.id][e];for(var s in r)if(r.hasOwnProperty(s)){var o=r[s];n+='<li><a id="'+e+"_"+s+'" href="#">'+o.title+"</a></li>"}if(!u("gmaps_context_menu"))return;var f=u("gmaps_context_menu");f.innerHTML=n;var l=f.getElementsByTagName("a"),c=l.length,s;for(s=0;s<c;s++){var h=l[s],p=function(n){n.preventDefault();r[this.id.replace(e+"_","")].action.apply(i,[t]);i.hideContextMenu()};google.maps.event.clearListeners(h,"click");google.maps.event.addDomListenerOnce(h,"click",p,!1)}var d=a.apply(this,[i.el]),v=d[0]+t.pixel.x-15,m=d[1]+t.pixel.y-15;f.style.left=v+"px";f.style.top=m+"px";f.style.display="block"};this.buildContextMenu=function(e,t){if(e==="marker"){t.pixel={};var n=new google.maps.OverlayView;n.setMap(i.map);n.draw=function(){var r=n.getProjection(),i=t.marker.getPosition();t.pixel=r.fromLatLngToContainerPixel(i);k(e,t)}}else k(e,t)};this.setContextMenu=function(e){window.context_menu[i.el.id][e.control]={};var t,r=n.createElement("ul");for(t in e.options)if(e.options.hasOwnProperty(t)){var s=e.options[t];window.context_menu[i.el.id][e.control][s.name]={title:s.title,action:s.action}}r.id="gmaps_context_menu";r.style.display="none";r.style.position="absolute";r.style.minWidth="100px";r.style.background="white";r.style.listStyle="none";r.style.padding="8px";r.style.boxShadow="2px 2px 6px #ccc";n.body.appendChild(r);var o=u("gmaps_context_menu");google.maps.event.addDomListener(o,"mouseout",function(e){(!e.relatedTarget||!this.contains(e.relatedTarget))&&window.setTimeout(function(){o.style.display="none"},400)},!1)};this.hideContextMenu=function(){var e=u("gmaps_context_menu");e&&(e.style.display="none")};var L=function(t,n){google.maps.event.addListener(t,n,function(t){t==undefined&&(t=this);e[n].apply(this,[t]);i.hideContextMenu()})};google.maps.event.addListener(this.map,"zoom_changed",this.hideContextMenu);for(var A=0;A<o.length;A++){var O=o[A];O in e&&L(this.map,O)}for(var A=0;A<f.length;A++){var O=f[A];O in e&&L(this.map,O)}google.maps.event.addListener(this.map,"rightclick",function(t){e.rightclick&&e.rightclick.apply(this,[t]);window.context_menu[i.el.id]["map"]!=undefined&&i.buildContextMenu("map",t)});this.refresh=function(){google.maps.event.trigger(this.map,"resize")};this.fitZoom=function(){var e=[],t=this.markers.length,n;for(n=0;n<t;n++)typeof this.markers[n].visible=="boolean"&&this.markers[n].visible&&e.push(this.markers[n].getPosition());this.fitLatLngBounds(e)};this.fitLatLngBounds=function(e){var t=e.length,n=new google.maps.LatLngBounds;for(var r=0;r<t;r++)n.extend(e[r]);this.map.fitBounds(n)};this.setCenter=function(e,t,n){this.map.panTo(new google.maps.LatLng(e,t));n&&n()};this.getElement=function(){return this.el};this.zoomIn=function(e){e=e||1;this.zoom=this.map.getZoom()+e;this.map.setZoom(this.zoom)};this.zoomOut=function(e){e=e||1;this.zoom=this.map.getZoom()-e;this.map.setZoom(this.zoom)};var M=[],_;for(_ in this.map)typeof this.map[_]=="function"&&!this[_]&&M.push(_);for(s=0;s<M.length;s++)(function(e,t,n){e[n]=function(){return t[n].apply(t,arguments)}})(this,this.map,M[s])};return r}(this);f.prototype.createControl=function(e){var t=document.createElement("div");t.style.cursor="pointer";if(e.disableDefaultStyles!==!0){t.style.fontFamily="Roboto, Arial, sans-serif";t.style.fontSize="11px";t.style.boxShadow="rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px"}for(var n in e.style)t.style[n]=e.style[n];e.id&&(t.id=e.id);e.classes&&(t.className=e.classes);e.content&&(typeof e.content=="string"?t.innerHTML=e.content:e.content instanceof HTMLElement&&t.appendChild(e.content));e.position&&(t.position=google.maps.ControlPosition[e.position.toUpperCase()]);for(var r in e.events)(function(t,n){google.maps.event.addDomListener(t,n,function(){e.events[n].apply(this,[this])})})(t,r);t.index=1;return t};f.prototype.addControl=function(e){var t=this.createControl(e);this.controls.push(t);this.map.controls[t.position].push(t);return t};f.prototype.removeControl=function(e){var t=null;for(var n=0;n<this.controls.length;n++)if(this.controls[n]==e){t=this.controls[n].position;this.controls.splice(n,1)}if(t)for(n=0;n<this.map.controls.length;n++){var r=this.map.controls[e.position];if(r.getAt(n)==e){r.removeAt(n);break}}return e};f.prototype.createMarker=function(e){if(e.lat==undefined&&e.lng==undefined&&e.position==undefined)throw"No latitude or longitude defined.";var n=this,r=e.details,i=e.fences,s=e.outside,o={position:new google.maps.LatLng(e.lat,e.lng),map:null},u=t(o,e);delete u.lat;delete u.lng;delete u.fences;delete u.outside;var a=new google.maps.Marker(u);a.fences=i;if(e.infoWindow){a.infoWindow=new google.maps.InfoWindow(e.infoWindow);var f=["closeclick","content_changed","domready","position_changed","zindex_changed"];for(var l=0;l<f.length;l++)(function(t,n){e.infoWindow[n]&&google.maps.event.addListener(t,n,function(t){e.infoWindow[n].apply(this,[t])})})(a.infoWindow,f[l])}var c=["animation_changed","clickable_changed","cursor_changed","draggable_changed","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"],h=["dblclick","drag","dragend","dragstart","mousedown","mouseout","mouseover","mouseup"];for(var l=0;l<c.length;l++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(){e[n].apply(this,[this])})})(a,c[l]);for(var l=0;l<h.length;l++)(function(t,n,r){e[r]&&google.maps.event.addListener(n,r,function(n){n.pixel||(n.pixel=t.getProjection().fromLatLngToPoint(n.latLng));e[r].apply(this,[n])})})(this.map,a,h[l]);google.maps.event.addListener(a,"click",function(){this.details=r;e.click&&e.click.apply(this,[this]);if(a.infoWindow){n.hideInfoWindows();a.infoWindow.open(n.map,a)}});google.maps.event.addListener(a,"rightclick",function(t){t.marker=this;e.rightclick&&e.rightclick.apply(this,[t]);window.context_menu[n.el.id]["marker"]!=undefined&&n.buildContextMenu("marker",t)});a.fences&&google.maps.event.addListener(a,"dragend",function(){n.checkMarkerGeofence(a,function(e,t){s(e,t)})});return a};f.prototype.addMarker=function(e){var t;if(e.hasOwnProperty("gm_accessors_"))t=e;else{if(!(e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")||e.position))throw"No latitude or longitude defined.";t=this.createMarker(e)}t.setMap(this.map);this.markerClusterer&&this.markerClusterer.addMarker(t);this.markers.push(t);f.fire("marker_added",t,this);return t};f.prototype.addMarkers=function(e){for(var t=0,n;n=e[t];t++)this.addMarker(n);return this.markers};f.prototype.hideInfoWindows=function(){for(var e=0,t;t=this.markers[e];e++)t.infoWindow&&t.infoWindow.close()};f.prototype.removeMarker=function(e){for(var t=0;t<this.markers.length;t++)if(this.markers[t]===e){this.markers[t].setMap(null);this.markers.splice(t,1);this.markerClusterer&&this.markerClusterer.removeMarker(e);f.fire("marker_removed",e,this);break}return e};f.prototype.removeMarkers=function(e){var t=[];if(typeof e=="undefined"){for(var n=0;n<this.markers.length;n++)this.markers[n].setMap(null);this.markers=t}else{for(var n=0;n<e.length;n++)this.markers.indexOf(e[n])>-1&&this.markers[n].setMap(null);for(var n=0;n<this.markers.length;n++)this.markers[n].getMap()!=null&&t.push(this.markers[n]);this.markers=t}};f.prototype.drawOverlay=function(e){var t=new google.maps.OverlayView,n=!0;t.setMap(this.map);e.auto_show!=null&&(n=e.auto_show);t.onAdd=function(){var n=document.createElement("div");n.style.borderStyle="none";n.style.borderWidth="0px";n.style.position="absolute";n.style.zIndex=100;n.innerHTML=e.content;t.el=n;e.layer||(e.layer="overlayLayer");var r=this.getPanes(),i=r[e.layer],s=["contextmenu","DOMMouseScroll","dblclick","mousedown"];i.appendChild(n);for(var o=0;o<s.length;o++)(function(e,t){google.maps.event.addDomListener(e,t,function(e){if(navigator.userAgent.toLowerCase().indexOf("msie")!=-1&&document.all){e.cancelBubble=!0;e.returnValue=!1}else e.stopPropagation()})})(n,s[o]);if(e.click){r.overlayMouseTarget.appendChild(t.el);google.maps.event.addDomListener(t.el,"click",function(){e.click.apply(t,[t])})}google.maps.event.trigger(this,"ready")};t.draw=function(){var r=this.getProjection(),i=r.fromLatLngToDivPixel(new google.maps.LatLng(e.lat,e.lng));e.horizontalOffset=e.horizontalOffset||0;e.verticalOffset=e.verticalOffset||0;var s=t.el,o=s.children[0],u=o.clientHeight,a=o.clientWidth;switch(e.verticalAlign){case"top":s.style.top=i.y-u+e.verticalOffset+"px";break;default:case"middle":s.style.top=i.y-u/2+e.verticalOffset+"px";break;case"bottom":s.style.top=i.y+e.verticalOffset+"px"}switch(e.horizontalAlign){case"left":s.style.left=i.x-a+e.horizontalOffset+"px";break;default:case"center":s.style.left=i.x-a/2+e.horizontalOffset+"px";break;case"right":s.style.left=i.x+e.horizontalOffset+"px"}s.style.display=n?"block":"none";n||e.show.apply(this,[s])};t.onRemove=function(){var n=t.el;if(e.remove)e.remove.apply(this,[n]);else{t.el.parentNode.removeChild(t.el);t.el=null}};this.overlays.push(t);return t};f.prototype.removeOverlay=function(e){for(var t=0;t<this.overlays.length;t++)if(this.overlays[t]===e){this.overlays[t].setMap(null);this.overlays.splice(t,1);break}};f.prototype.removeOverlays=function(){for(var e=0,t;t=this.overlays[e];e++)t.setMap(null);this.overlays=[]};f.prototype.drawPolyline=function(e){var t=[],n=e.path;if(n.length)if(n[0][0]===undefined)t=n;else for(var r=0,i;i=n[r];r++)t.push(new google.maps.LatLng(i[0],i[1]));var s={map:this.map,path:t,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight,geodesic:e.geodesic,clickable:!0,editable:!1,visible:!0};e.hasOwnProperty("clickable")&&(s.clickable=e.clickable);e.hasOwnProperty("editable")&&(s.editable=e.editable);e.hasOwnProperty("icons")&&(s.icons=e.icons);e.hasOwnProperty("zIndex")&&(s.zIndex=e.zIndex);var o=new google.maps.Polyline(s),u=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var a=0;a<u.length;a++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(t){e[n].apply(this,[t])})})(o,u[a]);this.polylines.push(o);f.fire("polyline_added",o,this);return o};f.prototype.removePolyline=function(e){for(var t=0;t<this.polylines.length;t++)if(this.polylines[t]===e){this.polylines[t].setMap(null);this.polylines.splice(t,1);f.fire("polyline_removed",e,this);break}};f.prototype.removePolylines=function(){for(var e=0,t;t=this.polylines[e];e++)t.setMap(null);this.polylines=[]};f.prototype.drawCircle=function(e){e=t({map:this.map,center:new google.maps.LatLng(e.lat,e.lng)},e);delete e.lat;delete e.lng;var n=new google.maps.Circle(e),r=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var i=0;i<r.length;i++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(t){e[n].apply(this,[t])})})(n,r[i]);this.polygons.push(n);return n};f.prototype.drawRectangle=function(e){e=t({map:this.map},e);var n=new google.maps.LatLngBounds(new google.maps.LatLng(e.bounds[0][0],e.bounds[0][1]),new google.maps.LatLng(e.bounds[1][0],e.bounds[1][1]));e.bounds=n;var r=new google.maps.Rectangle(e),i=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var s=0;s<i.length;s++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(t){e[n].apply(this,[t])})})(r,i[s]);this.polygons.push(r);return r};f.prototype.drawPolygon=function(e){var n=!1;e.hasOwnProperty("useGeoJSON")&&(n=e.useGeoJSON);delete e.useGeoJSON;e=t({map:this.map},e);n==0&&(e.paths=[e.paths.slice(0)]);e.paths.length>0&&e.paths[0].length>0&&(e.paths=i(r(e.paths,o,n)));var s=new google.maps.Polygon(e),u=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var a=0;a<u.length;a++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(t){e[n].apply(this,[t])})})(s,u[a]);this.polygons.push(s);f.fire("polygon_added",s,this);return s};f.prototype.removePolygon=function(e){for(var t=0;t<this.polygons.length;t++)if(this.polygons[t]===e){this.polygons[t].setMap(null);this.polygons.splice(t,1);f.fire("polygon_removed",e,this);break}};f.prototype.removePolygons=function(){for(var e=0,t;t=this.polygons[e];e++)t.setMap(null);this.polygons=[]};f.prototype.getFromFusionTables=function(e){var t=e.events;delete e.events;var n=e,r=new google.maps.FusionTablesLayer(n);for(var i in t)(function(e,n){google.maps.event.addListener(e,n,function(e){t[n].apply(this,[e])})})(r,i);this.layers.push(r);return r};f.prototype.loadFromFusionTables=function(e){var t=this.getFromFusionTables(e);t.setMap(this.map);return t};f.prototype.getFromKML=function(e){var t=e.url,n=e.events;delete e.url;delete e.events;var r=e,i=new google.maps.KmlLayer(t,r);for(var s in n)(function(e,t){google.maps.event.addListener(e,t,function(e){n[t].apply(this,[e])})})(i,s);this.layers.push(i);return i};f.prototype.loadFromKML=function(e){var t=this.getFromKML(e);t.setMap(this.map);return t};f.prototype.addLayer=function(e,t){t=t||{};var n;switch(e){case"weather":this.singleLayers.weather=n=new google.maps.weather.WeatherLayer;break;case"clouds":this.singleLayers.clouds=n=new google.maps.weather.CloudLayer;break;case"traffic":this.singleLayers.traffic=n=new google.maps.TrafficLayer;break;case"transit":this.singleLayers.transit=n=new google.maps.TransitLayer;break;case"bicycling":this.singleLayers.bicycling=n=new google.maps.BicyclingLayer;break;case"panoramio":this.singleLayers.panoramio=n=new google.maps.panoramio.PanoramioLayer;n.setTag(t.filter);delete t.filter;t.click&&google.maps.event.addListener(n,"click",function(e){t.click(e);delete t.click});break;case"places":this.singleLayers.places=n=new google.maps.places.PlacesService(this.map);if(t.search||t.nearbySearch||t.radarSearch){var r={bounds:t.bounds||null,keyword:t.keyword||null,location:t.location||null,name:t.name||null,radius:t.radius||null,rankBy:t.rankBy||null,types:t.types||null};t.radarSearch&&n.radarSearch(r,t.radarSearch);t.search&&n.search(r,t.search);t.nearbySearch&&n.nearbySearch(r,t.nearbySearch)}if(t.textSearch){var i={bounds:t.bounds||null,location:t.location||null,query:t.query||null,radius:t.radius||null};n.textSearch(i,t.textSearch)}}if(n!==undefined){typeof n.setOptions=="function"&&n.setOptions(t);typeof n.setMap=="function"&&n.setMap(this.map);return n}};f.prototype.removeLayer=function(e){if(typeof e=="string"&&this.singleLayers[e]!==undefined){this.singleLayers[e].setMap(null);delete this.singleLayers[e]}else for(var t=0;t<this.layers.length;t++)if(this.layers[t]===e){this.layers[t].setMap(null);this.layers.splice(t,1);break}};var l,c;f.prototype.getRoutes=function(e){switch(e.travelMode){case"bicycling":l=google.maps.TravelMode.BICYCLING;break;case"transit":l=google.maps.TravelMode.TRANSIT;break;case"driving":l=google.maps.TravelMode.DRIVING;break;default:l=google.maps.TravelMode.WALKING}e.unitSystem==="imperial"?c=google.maps.UnitSystem.IMPERIAL:c=google.maps.UnitSystem.METRIC;var n={avoidHighways:!1,avoidTolls:!1,optimizeWaypoints:!1,waypoints:[]},r=t(n,e);r.origin=/string/.test(typeof e.origin)?e.origin:new google.maps.LatLng(e.origin[0],e.origin[1]);r.destination=/string/.test(typeof e.destination)?e.destination:new google.maps.LatLng(e.destination[0],e.destination[1]);r.travelMode=l;r.unitSystem=c;delete r.callback;delete r.error;var i=this,s=new google.maps.DirectionsService;s.route(r,function(t,n){if(n===google.maps.DirectionsStatus.OK){for(var r in t.routes)t.routes.hasOwnProperty(r)&&i.routes.push(t.routes[r]);e.callback&&e.callback(i.routes)}else e.error&&e.error(t,n)})};f.prototype.removeRoutes=function(){this.routes=[]};f.prototype.getElevations=function(e){e=t({locations:[],path:!1,samples:256},e);e.locations.length>0&&e.locations[0].length>0&&(e.locations=i(r([e.locations],o,!1)));var n=e.callback;delete e.callback;var s=new google.maps.ElevationService;if(!e.path){delete e.path;delete e.samples;s.getElevationForLocations(e,function(e,t){n&&typeof n=="function"&&n(e,t)})}else{var u={path:e.locations,samples:e.samples};s.getElevationAlongPath(u,function(e,t){n&&typeof n=="function"&&n(e,t)})}};f.prototype.cleanRoute=f.prototype.removePolylines;f.prototype.drawRoute=function(e){var t=this;this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,unitSystem:e.unitSystem,error:e.error,callback:function(n){if(n.length>0){t.drawPolyline({path:n[n.length-1].overview_path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight});e.callback&&e.callback(n[n.length-1])}}})};f.prototype.travelRoute=function(e){if(e.origin&&e.destination)this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,unitSystem:e.unitSystem,error:e.error,callback:function(t){t.length>0&&e.start&&e.start(t[t.length-1]);if(t.length>0&&e.step){var n=t[t.length-1];if(n.legs.length>0){var r=n.legs[0].steps;for(var i=0,s;s=r[i];i++){s.step_number=i;e.step(s,n.legs[0].steps.length-1)}}}t.length>0&&e.end&&e.end(t[t.length-1])}});else if(e.route&&e.route.legs.length>0){var t=e.route.legs[0].steps;for(var n=0,r;r=t[n];n++){r.step_number=n;e.step(r)}}};f.prototype.drawSteppedRoute=function(e){var t=this;if(e.origin&&e.destination)this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,error:e.error,callback:function(n){n.length>0&&e.start&&e.start(n[n.length-1]);if(n.length>0&&e.step){var r=n[n.length-1];if(r.legs.length>0){var i=r.legs[0].steps;for(var s=0,o;o=i[s];s++){o.step_number=s;t.drawPolyline({path:o.path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight});e.step(o,r.legs[0].steps.length-1)}}}n.length>0&&e.end&&e.end(n[n.length-1])}});else if(e.route&&e.route.legs.length>0){var n=e.route.legs[0].steps;for(var r=0,i;i=n[r];r++){i.step_number=r;t.drawPolyline({path:i.path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight});e.step(i)}}};f.Route=function(e){this.origin=e.origin;this.destination=e.destination;this.waypoints=e.waypoints;this.map=e.map;this.route=e.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight}).getPath()};f.Route.prototype.getRoute=function(t){var n=this;this.map.getRoutes({origin:this.origin,destination:this.destination,travelMode:t.travelMode,waypoints:this.waypoints||[],error:t.error,callback:function(){n.route=e[0];t.callback&&t.callback.call(n)}})};f.Route.prototype.back=function(){if(this.step_count>0){this.step_count--;var e=this.route.legs[0].steps[this.step_count].path;for(var t in e)e.hasOwnProperty(t)&&this.polyline.pop()}};f.Route.prototype.forward=function(){if(this.step_count<this.steps_length){var e=this.route.legs[0].steps[this.step_count].path;for(var t in e)e.hasOwnProperty(t)&&this.polyline.push(e[t]);this.step_count++}};f.prototype.checkGeofence=function(e,t,n){return n.containsLatLng(new google.maps.LatLng(e,t))};f.prototype.checkMarkerGeofence=function(e,t){if(e.fences)for(var n=0,r;r=e.fences[n];n++){var i=e.getPosition();this.checkGeofence(i.lat(),i.lng(),r)||t(e,r)}};f.prototype.toImage=function(e){var e=e||{},t={};t.size=e.size||[this.el.clientWidth,this.el.clientHeight];t.lat=this.getCenter().lat();t.lng=this.getCenter().lng();if(this.markers.length>0){t.markers=[];for(var n=0;n<this.markers.length;n++)t.markers.push({lat:this.markers[n].getPosition().lat(),lng:this.markers[n].getPosition().lng()})}if(this.polylines.length>0){var r=this.polylines[0];t.polyline={};t.polyline.path=google.maps.geometry.encoding.encodePath(r.getPath());t.polyline.strokeColor=r.strokeColor;t.polyline.strokeOpacity=r.strokeOpacity;t.polyline.strokeWeight=r.strokeWeight}return f.staticMapURL(t)};f.staticMapURL=function(e){function t(e,t){if(e[0]==="#"){e=e.replace("#","0x");if(t){t=parseFloat(t);t=Math.min(1,Math.max(t,0));if(t===0)return"0x00000000";t=(t*255).toString(16);t.length===1&&(t+=t);e=e.slice(0,8)+t}}return e}var n=[],r,i="http://maps.googleapis.com/maps/api/staticmap";if(e.url){i=e.url;delete e.url}i+="?";var s=e.markers;delete e.markers;if(!s&&e.marker){s=[e.marker];delete e.marker}var o=e.styles;delete e.styles;var u=e.polyline;delete e.polyline;if(e.center){n.push("center="+e.center);delete e.center}else if(e.address){n.push("center="+e.address);delete e.address}else if(e.lat){n.push(["center=",e.lat,",",e.lng].join(""));delete e.lat;delete e.lng}else if(e.visible){var a=encodeURI(e.visible.join("|"));n.push("visible="+a)}var f=e.size;if(f){f.join&&(f=f.join("x"));delete e.size}else f="630x300";n.push("size="+f);!e.zoom&&e.zoom!==!1&&(e.zoom=15);var l=e.hasOwnProperty("sensor")?!!e.sensor:!0;delete e.sensor;n.push("sensor="+l);for(var c in e)e.hasOwnProperty(c)&&n.push(c+"="+e[c]);if(s){var h,p;for(var d=0;r=s[d];d++){h=[];if(r.size&&r.size!=="normal"){h.push("size:"+r.size);delete r.size}else if(r.icon){h.push("icon:"+encodeURI(r.icon));delete r.icon}if(r.color){h.push("color:"+r.color.replace("#","0x"));delete r.color}if(r.label){h.push("label:"+r.label[0].toUpperCase());delete r.label}p=r.address?r.address:r.lat+","+r.lng;delete r.address;delete r.lat;delete r.lng;for(var c in r)r.hasOwnProperty(c)&&h.push(c+":"+r[c]);if(h.length||d===0){h.push(p);h=h.join("|");n.push("markers="+encodeURI(h))}else{h=n.pop()+encodeURI("|"+p);n.push(h)}}}if(o)for(var d=0;d<o.length;d++){var v=[];o[d].featureType&&v.push("feature:"+o[d].featureType.toLowerCase());o[d].elementType&&v.push("element:"+o[d].elementType.toLowerCase());for(var m=0;m<o[d].stylers.length;m++)for(var g in o[d].stylers[m]){var y=o[d].stylers[m][g];if(g=="hue"||g=="color")y="0x"+y.substring(1);v.push(g+":"+y)}var b=v.join("|");b!=""&&n.push("style="+b)}if(u){r=u;u=[];r.strokeWeight&&u.push("weight:"+parseInt(r.strokeWeight,10));if(r.strokeColor){var w=t(r.strokeColor,r.strokeOpacity);u.push("color:"+w)}if(r.fillColor){var E=t(r.fillColor,r.fillOpacity);u.push("fillcolor:"+E)}var S=r.path;if(S.join)for(var m=0,x;x=S[m];m++)u.push(x.join(","));else u.push("enc:"+S);u=u.join("|");n.push("path="+encodeURI(u))}var T=window.devicePixelRatio||1;n.push("scale="+T);n=n.join("&");return i+n};f.prototype.addMapType=function(e,t){if(!t.hasOwnProperty("getTileUrl")||typeof t["getTileUrl"]!="function")throw"'getTileUrl' function required.";t.tileSize=t.tileSize||new google.maps.Size(256,256);var n=new google.maps.ImageMapType(t);this.map.mapTypes.set(e,n)};f.prototype.addOverlayMapType=function(e){if(!e.hasOwnProperty("getTile")||typeof e["getTile"]!="function")throw"'getTile' function required.";var t=e.index;delete e.index;this.map.overlayMapTypes.insertAt(t,e)};f.prototype.removeOverlayMapType=function(e){this.map.overlayMapTypes.removeAt(e)};f.prototype.addStyle=function(e){var t=new google.maps.StyledMapType(e.styles,{name:e.styledMapName});this.map.mapTypes.set(e.mapTypeId,t)};f.prototype.setStyle=function(e){this.map.setMapTypeId(e)};f.prototype.createPanorama=function(e){if(!e.hasOwnProperty("lat")||!e.hasOwnProperty("lng")){e.lat=this.getCenter().lat();e.lng=this.getCenter().lng()}this.panorama=f.createPanorama(e);this.map.setStreetView(this.panorama);return this.panorama};f.createPanorama=function(e){var n=u(e.el,e.context);e.position=new google.maps.LatLng(e.lat,e.lng);delete e.el;delete e.context;delete e.lat;delete e.lng;var r=["closeclick","links_changed","pano_changed","position_changed","pov_changed","resize","visible_changed"],i=t({visible:!0},e);for(var s=0;s<r.length;s++)delete i[r[s]];var o=new google.maps.StreetViewPanorama(n,i);for(var s=0;s<r.length;s++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(){e[n].apply(this)})})(o,r[s]);return o};f.prototype.on=function(e,t){return f.on(e,this,t)};f.prototype.off=function(e){f.off(e,this)};f.custom_events=["marker_added","marker_removed","polyline_added","polyline_removed","polygon_added","polygon_removed","geolocated","geolocation_failed"];f.on=function(e,t,n){if(f.custom_events.indexOf(e)==-1){t instanceof f&&(t=t.map);return google.maps.event.addListener(t,e,n)}var r={handler:n,eventName:e};t.registered_events[e]=t.registered_events[e]||[];t.registered_events[e].push(r);return r};f.off=function(e,t){if(f.custom_events.indexOf(e)==-1){t instanceof f&&(t=t.map);google.maps.event.clearListeners(t,e)}else t.registered_events[e]=[]};f.fire=function(e,t,n){if(f.custom_events.indexOf(e)==-1)google.maps.event.trigger(t,e,Array.prototype.slice.apply(arguments).slice(2));else if(e in n.registered_events){var r=n.registered_events[e];for(var i=0;i<r.length;i++)(function(e,t,n){e.apply(t,[n])})(r[i].handler,n,t)}};f.geolocate=function(e){var t=e.always||e.complete;if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(n){e.success(n);t&&t()},function(n){e.error(n);t&&t()},e.options);else{e.not_supported();t&&t()}};f.geocode=function(e){this.geocoder=new google.maps.Geocoder;var t=e.callback;e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")&&(e.latLng=new google.maps.LatLng(e.lat,e.lng));delete e.lat;delete e.lng;delete e.callback;this.geocoder.geocode(e,function(e,n){t(e,n)})};google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(e){var t=new google.maps.LatLngBounds,n=this.getPaths(),r;for(var i=0;i<n.getLength();i++){r=n.getAt(i);for(var s=0;s<r.getLength();s++)t.extend(r.getAt(s))}return t});google.maps.Polygon.prototype.containsLatLng||(google.maps.Polygon.prototype.containsLatLng=function(e){var t=this.getBounds();if(t!==null&&!t.contains(e))return!1;var n=!1,r=this.getPaths().getLength();for(var i=0;i<r;i++){var s=this.getPaths().getAt(i),o=s.getLength(),u=o-1;for(var a=0;a<o;a++){var f=s.getAt(a),l=s.getAt(u);(f.lng()<e.lng()&&l.lng()>=e.lng()||l.lng()<e.lng()&&f.lng()>=e.lng())&&f.lat()+(e.lng()-f.lng())/(l.lng()-f.lng())*(l.lat()-f.lat())<e.lat()&&(n=!n);u=a}}return n});google.maps.Circle.prototype.containsLatLng||(google.maps.Circle.prototype.containsLatLng=function(e){return google.maps.geometry?google.maps.geometry.spherical.computeDistanceBetween(this.getCenter(),e)<=this.getRadius():!0});google.maps.LatLngBounds.prototype.containsLatLng=function(e){return this.contains(e)};google.maps.Marker.prototype.setFences=function(e){this.fences=e};google.maps.Marker.prototype.addFence=function(e){this.fences.push(e)};google.maps.Marker.prototype.getId=function(){return this.__gm_id};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;if(arguments.length>1){r=Number(arguments[1]);r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r)))}if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});return f});